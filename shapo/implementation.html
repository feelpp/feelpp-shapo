<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Implementation in Feel++ :: Feel++ ShapO // Docs</title>
    <link rel="canonical" href="https://feelpp.github.io/feelpp-shapo/shapo/implementation.html">
    <meta name="description" content="Geometric Shape Optimisation implementation">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<script>!function(l,p){if(l.protocol!==p&&l.host=="docs.antora.org"){l.protocol=p}else if(/\.gitlab\.io$/.test(l.host)){l.replace(p+"//docs.antora.org"+l.pathname.substr(l.pathname.indexOf("/",1))+l.search+l.hash)}}(location,"https:")</script>

<script src="../_/js/vendor/tabs-block-extension.js"></script>
<script src="../_/js/vendor/tabs-block-behavior.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']],
    processEscapes: true,
    processEnvironments: true,
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },

  TeX: {
      Macros: {
      RR: "{\\mathbb R}",
      NN: "{\\mathbb N}",
      Nso: "{N_{\\mathrm{so}}}",
      Nma: "{N_{\\mathrm{ma}}}",
      Nno: "{N_{\\mathrm{no}}}",
      Ne: "{N_{\\mathrm{e}}}",
      Ilag: ["{\\mathcal{I}^{\\mathrm{lag}}_{#1}}",1],
      calTh: "{\\mathcal{T}_h}",
      Ck: ["{\\mathcal{C}^{#1}}",1],
      Pk: ["{\\mathcal{P}^{#1}}",1],
      Qk: ["{\\mathcal{Q}^{#1}}",1],
      Pch: ["{P^{#1}_{c,h}}",1],
      Pcho: ["{P^{#1}_{c,h,0}}",1],
      Qch: ["{Q^{#1}_{c,h}}",1],
      Ich: ["{\\mathcal{I}^{#1}_{c,h}#2}",2],
      poly: ["{\\mathbb{#1}}",1],
      nf: "{n_f}",
      ngeo: "{n_{\\mathrm{geo}}}",
      geo: "{\\mathrm{geo}}",
      card: ["{\\operatorname{card}(#1)}",1],
      dim: ["{\\operatorname{dim}(#1)}",1],
      opdim: "{\\operatorname{dim}}",
      card: ["{\\operatorname{card}(#1)}",1],
      poly: ["{\\mathbb{#1}",1],
      R: ["{\\mathbb{R}^{#1}}",1],
      set: ["{\\left\\{#1\\right\\}}",1],
      diam: "{\\operatorname{diam}}",
      jump: ["{[\\![ #1 ]\\!]}",1],
      Next: "{\\mathrm{n}}",
      essinf: "{\\operatorname{ess}\\, \\operatorname{inf}}",
      tr: "{\\operatorname{tr}}",
      Id: "{\\mathcal{I}}",
      disp: ["{\\mathbf{#1}}",1],
      stresst: ["{\\mathbf{\\sigma(#1)}}",1],
      deformt: ["{\\mathbf{\\varepsilon(#1)}}",1],
      domain: "{\\Omega}",
      prect: ["{\\left\\(#1\\right\\)}",1],
      ds: "",
      bold: ["{\\bf #1}",1],
      p: "{\\mathrm{p}}",
      q:"{\\mathbf{q}}",
      n:"{\\mathbf{n}}",
      T:"{\\mathcal{T}}",
      F:"{\\mathcal{F}}",
      P:"{\\mathcal{P}}",
      v:"{\\mathbf{v}}"
  },
  extensions: ["mhchem.js"] }
});
</script>
<!--<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML"></script>-->
<!-- <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script> -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML'>
</script>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>-->

<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" crossorigin="anonymous"></script>-->
<script>var uiRootPath = '../_'</script>

  </head>
  <body class="article">
<header class="header">
  <nav class="navbar  navbar-expand-sm bg-dark navbar-dark">
    <div class="navbar-brand">
      <div class="navbar-item feelpp-logo">
        <a href="https://feelpp.github.io/feelpp-shapo"><img src="../_/img/feelpp-logo.svg" alt="Feel++ logo"/></a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item search hide-for-print">
          <form class="search">
            <i class="fa-solid fa-search"></i>
            <input type="text" placeholder="Search Feel++ ShapO // Docs" class="query" id="search-query">
          </form>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Manuals</div>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.feelpp.org/user/">User</a>
            <a class="navbar-item" href="https://docs.feelpp.org/dev/">Developer</a>
            <a class="navbar-item" href="https://docs.feelpp.org/toolbox/">Toolbox</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link" data-title="Support">
            <span class="icon"><img src="../_/img/octicons-24.svg#view-comment-discussion"></span>
          </div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item has-icon" href="https://join.slack.com/t/feelpp/shared_invite/zt-2qe0q9hw-4pVbhohCXUE6Po9Ma8dbiQ" target="_blank" rel="noopener">
              <span class="icon"><img src="../_/img/slack-icon.svg"></span>
              <span>Chat</span>
            </a>
            <a class="navbar-item has-icon" href="https://github.com/orgs/feelpp/discussions" target="_blank" rel="noopener">
              <span class="icon"><img src="../_/img/octicons-16.svg#view-discussion-closed"></span>
              <span>Discussions</span>
            </a>
            <a class="navbar-item has-icon" href="https://github.com/feelpp" target="_blank" rel="noopener">
              <span class="icon"><img src="../_/img/octicons-16.svg#view-mark-github"></span>
              <span>Source</span>
            </a>
            <a class="navbar-item has-icon" href="https://twitter.com/feelpp" target="_blank" rel="noopener">
              <span class="icon"><img src="../_/img/octicons-16.svg#view-hash"></span>
              <span>Tweets</span>
            </a>
            <a class="navbar-item has-icon" href="https://github.com/feelpp/book.feelpp.org/issues/new">
              <span class="icon"><img src="../_/img/octicons-16.svg#view-bug"></span>
              <span>Issues</span>
            </a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable download-item">
        </div>
        <div class="navbar-item">
          <a class="navbar-brand"  href="https://www.cemosis.fr">
            <img class="cemosis-logo"  src="../_/img/cemosis-logo.svg" alt="Cemosis logo"/>
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<a href="#" class="menu-expand-toggle"></a>
<div class="nav-container" data-component="shapo" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Feel++ ShapO</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text">Feel++ project</span>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Shape Optimisation</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Feel++ ShapO</span>
    <span class="version"></span>
  </div>
  <ul class="components">
      <li class="component is-current">
        <a class="title" href="index.html">Feel++ ShapO</a>
      </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
    <a href="index.html" class="home-link"></a>
  <nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Feel++ ShapO</a></li>
    <li><a href="implementation.html">Implementation in Feel++</a></li>
  </ul>
</nav>

  
    <div class="edit-this-page"><a href="https://github.com/feelpp/feelpp-shapo/edit/master/docs/modules/ROOT/pages/implementation.adoc">Edit this Page</a></div>
  
  <div class="page-downloads">
  <span class="label">Download as</span>
  <ul class="download-options">
    <li>
      <a onclick="print(this)" href="#" data-toggle="tooltip" data-placement="left" title="Print to PDF"
         class="pdf-download">
        <img class="pdf-file-icon icon" src="../_/img/pdf.svg"/> .pdf
      </a>
    </li>
  </ul>
</div>
</div>

  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Implementation in Feel++</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_json_files">1. Json files</a>
<ul class="sectlevel2">
<li><a href="#_primal_problem">1.1. Primal problem</a></li>
<li><a href="#_dual_problem">1.2. Dual problem</a></li>
<li><a href="#_postprocessing">1.3. Postprocessing</a></li>
<li><a href="#_postprocessing_of_xi_j">1.4. Postprocessing of \(\xi_J\)</a></li>
<li><a href="#_transpose_of_dg">1.5. Transpose of \(Dg\)</a></li>
<li><a href="#_expansion">1.6. Expansion</a></li>
<li><a href="#_parameters">1.7. Parameters</a></li>
</ul>
</li>
<li><a href="#_algorithm">2. Algorithm</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The code is based on Lucas Palazzolo&#8217;s course. For more details, see <a href="#internship_Palazzolo">[internship_Palazzolo]</a>.</p>
</div>
<div class="paragraph">
<p>The <code>shape_opti.py</code> code for solving geometric shape optimization problems relies on the Feel++ toolboxes, specifically <code>cfpdes</code>, <code>fluid</code>, and <code>solid</code>. To solve a problem of this nature, a set of JSON files is required, each serving a specific purpose in the optimization process. Here, we&#8217;ll provide an overview of these JSON files and their roles within the implementation.</p>
</div>
<div class="paragraph">
<p>The <code>Models</code> in the JSON files correspond to different toolboxes and problem types. The following is a list of the valid <code>Models</code> names:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>primal_cfpdes</code></p>
</li>
<li>
<p><code>primal_fluid</code></p>
</li>
<li>
<p><code>primal_solid</code></p>
</li>
<li>
<p><code>dual_cfpdes</code></p>
</li>
<li>
<p><code>dual_fluid</code></p>
</li>
<li>
<p><code>dual_solid</code></p>
</li>
<li>
<p><code>expansion</code></p>
</li>
<li>
<p><code>postproc</code></p>
</li>
<li>
<p><code>dgtranspose</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The choice of <code>Model</code> depends on the toolbox you are using and the specific type of optimization problem you intend to solve. Here&#8217;s an example to help illustrate how these JSON files are used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"Models": <i class="conum" data-value="1"></i><b>(1)</b>
{
  "primal_cfpdes":<i class="conum" data-value="2"></i><b>(2)</b>
  {
    "equations" : ...
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>start section <code>Models</code> defined by the toolbox to define the main configuration and particularly the set of equations to be solved</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>toolbox keyword</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For some json files, it will be necessary to use save fields in order to use them as parameters. To do this, fill in the "Meshes" field as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"Meshes":
{
    "expansion":
    {

        "Fields":  <i class="conum" data-value="1"></i><b>(1)</b>
        {
            "primal_u" :
            {
                "filename":"$cfgdir/../feelppdb/shape_opti_stokes/np_1/primal_fluid.save/velocity.h5",
                "basis":"Pchv2"
            },
            "dual_u" :
            {
                "filename":"$cfgdir/../feelppdb/shape_opti_stokes/np_1/dual_fluid.save/velocity.h5",
                "basis":"Pchv2"
            },
            "DgT":
            {
                "filename":"$cfgdir/../feelppdb/shape_opti_stokes/np_1/Dgtranspose.save/DgT.h5",
                "basis":"Pchv1"
            }
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The different fields that we want to import by specifying the path and the basis.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_json_files"><a class="anchor" href="#_json_files"></a>1. Json files</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_primal_problem"><a class="anchor" href="#_primal_problem"></a>1.1. Primal problem</h3>
<div class="paragraph">
<p>Solves the primal problem. The json file of the primal problem must contain in the <code>Models</code> field: <code>primal_cfpdes</code>, <code>primal_fluid</code> or <code>primal_solid</code>. Don&#8217;t forget to save all fields in post-processing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dual_problem"><a class="anchor" href="#_dual_problem"></a>1.2. Dual problem</h3>
<div class="paragraph">
<p>Solves the dual problem. The json file of the dual problem must contain in the <code>Models</code> field: <code>dual_cfpdes</code>, <code>dual_fluid</code>, or <code>dual_solid</code>. Don&#8217;t forget to save all fields in post-processing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_postprocessing"><a class="anchor" href="#_postprocessing"></a>1.3. Postprocessing</h3>
<div class="paragraph">
<p>Computes some data needed to compute the \(\theta\) displacement field. The json file for the associated problem must contain <code>postproc</code> in the <code>Models</code> field. Load the various fields required. In postprocessing, save the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cost_function</code> : Cost function</p>
</li>
<li>
<p><code>volume</code> : Volume of the domain</p>
</li>
<li>
<p><code>gradient</code> : Shape gradient</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If GD :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>surface_movable</code> : Surface of the movable part of the domain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If NSGF :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DgDgT</code> : Computation of \(DgDg^T\).</p>
</li>
<li>
<p><code>DggradJ</code> : Computation of \(Dg\nabla J\).</p>
</li>
<li>
<p><code>norm_inf_DgT</code> : Computation of \(\|Dg^T\|\).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_postprocessing_of_xi_j"><a class="anchor" href="#_postprocessing_of_xi_j"></a>1.4. Postprocessing of \(\xi_J\)</h3>
<div class="paragraph">
<p>Only necessary when using the NSGF method. Computes the infinite norm of \(\xi_J\). The json file for the associated problem must contain <code>postproc</code> in the <code>Models</code> field. You need to load the various fields required. In postprocessing, save <code>norm_inf_xij</code>, which corresponds to the infinite norm of \(\xi_J\).</p>
</div>
</div>
<div class="sect2">
<h3 id="_transpose_of_dg"><a class="anchor" href="#_transpose_of_dg"></a>1.5. Transpose of \(Dg\)</h3>
<div class="paragraph">
<p>Solve the PDE to obtein the transpose of \(Dg\). The json file for the associated problem must contain <code>dgtranspose</code> in the <code>Models</code> field. In postprocessing, save all the fields.</p>
</div>
</div>
<div class="sect2">
<h3 id="_expansion"><a class="anchor" href="#_expansion"></a>1.6. Expansion</h3>
<div class="paragraph">
<p>Computes the displacement field. The json file for the expansion problem must contain <code>expansion</code> in the <code>Models</code> field. Load the various fields required. In post-processing, save the \(\|\theta\|_{H^1}\).</p>
</div>
</div>
<div class="sect2">
<h3 id="_parameters"><a class="anchor" href="#_parameters"></a>1.7. Parameters</h3>
<div class="paragraph">
<p>Contains all the information needed to solve the optimization problem. Depending on the field, certain subfields must be specified in order to refer to dedicated problems: <code>primal</code>, <code>dual</code>, <code>expansion</code>, <code>postproc</code>, <code>config</code>, <code>postprocxij</code>, <code>dgt</code>. The json must have the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "is_compliant" : 0, <i class="conum" data-value="1"></i><b>(1)</b>
    "geometry" : "stokes/3D/sphere3D.geo", <i class="conum" data-value="2"></i><b>(2)</b>
    "name" : "fluid_K11", <i class="conum" data-value="3"></i><b>(3)</b>
    "required_facets" : "GammaB", <i class="conum" data-value="4"></i><b>(4)</b>
    "folders" : { "folder"  : "shape_opti_stokes", "primal" : "stokes/3D/fluid/primal3D_fluid.json", "dual" : "stokes/3D/fluid/dual3D_fluid.json", "expansion" : "stokes/3D/fluid/expansion3D_P1_fluid.json", "postproc" : "stokes/3D/fluid/postprocess3D_fluid.json", "config" : "stokes/stokes_lu.cfg"}, <i class="conum" data-value="5"></i><b>(5)</b>
    "h" : 0.2, <i class="conum" data-value="6"></i><b>(6)</b>
    "dim" : 3, <i class="conum" data-value="7"></i><b>(7)</b>
    "opti_type" : "GD", <i class="conum" data-value="8"></i><b>(8)</b>
    "type" : {"primal" : "fluid", "dual" : "fluid", "expansion" : "cfpdes", "postproc" : "cfpdes"}, <i class="conum" data-value="9"></i><b>(9)</b>
    "param_primal" : {"Mu": 1, "U_1": 1, "U_1x" : 0, "U_1y" : 0, "U_1z" : 0, "U_2": 0 , "U_2x" : 0, "U_2y" : 0, "U_2z" : 0, "U_3" : 0, "U_3x" : 0, "U_3y" : 0, "U_3z" : 0, "Uinf_1": 0, "Uinf_2": 0, "Uinf_3" : 0}, <i class="conum" data-value="10"></i><b>(10)</b>
    "param_dual" : {"Mu":1, "alpha_1": 1, "alpha_1x" : 0, "alpha_1y" : 0, "alpha_1z" : 0, "alpha_2": 0, "alpha_2x" : 0, "alpha_2y" : 0, "alpha_2z" : 0, "alpha_3" : 0, "alpha_3x" : 0, "alpha_3y" : 0, "alpha_3z" : 0}, <i class="conum" data-value="11"></i><b>(11)</b>
    "param_expansion" : {"Mu":1, "t":0.03, "l":20}, <i class="conum" data-value="12"></i><b>(12)</b>
    "param_postproc" : {"Mu" : 1, "alpha_1": 1, "alpha_1x" : 0, "alpha_1y" : 0, "alpha_1z" : 0, "alpha_2": 0, "alpha_2x" : 0, "alpha_2y" : 0, "alpha_2z" : 0, "alpha_3" : 0, "alpha_3x" : 0, "alpha_3y" : 0, "alpha_3z" : 0}, <i class="conum" data-value="13"></i><b>(13)</b>
    "param_dgt" : {"Eps" : }, <i class="conum" data-value="14"></i><b>(14)</b>
    "param_optimization" : {"l":20, "t":0.03, "a":0.05, "b":0.5, "c" : 1000, "Nmax" : 1000, "etol" : 1e-7} <i class="conum" data-value="15"></i><b>(15)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>0</code> if no dual problem, <code>1</code> otherwise</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>path of the initial mesh file</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>name of the study case</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>faced of the mesh that we don&#8217;t want to remesh</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>path of the folder where the various data are/will be stored and path of json files</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>mesh size</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>dimension of the problem</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>type of optimization : gradient descent <code>GD</code> or null space gradient flow <code>NSGF</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>type of tooloboxes used for the json files : <code>cfpdes</code>, <code>fluid</code>, <code>solid</code></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>parameters of the primal json</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>parameters of the dual json</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>parameters of the expansion json</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>parameters of the postproc json</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>parameters of the dgt jon</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>parameters of the optimization problem : <code>Nmax</code>, <code>etol</code>. Specifically for the gradient descent we have to add : <code>l</code>, <code>t</code>, <code>a</code>, <code>b</code>, <code>c</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_algorithm"><a class="anchor" href="#_algorithm"></a>2. Algorithm</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that the data needed to solve a shape optimization problem has been described, let&#8217;s present the main points of the algorithm.</p>
</div>
<div class="literalblock pseudocode">
<div class="content">
<pre>\begin{algorithm}
\caption{Geometric shape optimisation algorithm}
\begin{algorithmic}
\STATE \textbf{Input:} Parameters json file
\STATE \textbf{Output:} Csv and paraview files for each iteration\\

\STATE \textbf{Initialization:}
  \STATE
  \STATE
  \STATE  $\quad$- $n=0$.
  \STATE  $\quad$- Reading the json file containing the parameters.
  \STATE  $\quad$- Solve the primal problem.
  \STATE  $\quad$- Solve the dual problem.
  \STATE  $\quad$- Solve the postprocessing problem.
  \STATE
  \IF {NSGF}
      \STATE $\quad$- Solve the postprocessing of $\xi_J$ problem.
      \STATE $\quad$- Solve the $Dg^T$ problem.
  \ENDIF
  \STATE
  \STATE $\quad$- Solve the expansion problem : $\theta_n$.
\STATE \textbf{Main loop:}
\STATE
\STATE
  \WHILE{$\|\theta_n\|_{H^1}&gt;\varepsilon_{tol}$ AND $n&lt;N_{max}$}
    \STATE  $\quad$- Deforming the mesh by applying $\theta_n$.
    \STATE
    \IF {mesh quality $&lt; q$}
      \STATE $\quad$- Remesh.
    \ENDIF
    \STATE
    \STATE  $\quad$- Solve the primal problem.
    \STATE  $\quad$- Solve the dual problem.
    \STATE  $\quad$- Solve the postprocessing problem.
    \STATE
    \IF {NSGF}
      \STATE $\quad$- Solve the postprocessing of $\xi_J$ problem.
      \STATE $\quad$- Solve the $Dg^T$ problem.
    \ENDIF
    \STATE
    \STATE $\quad$- Solve the expansion problem : $\theta_n$.
    \STATE  $\quad$- $n=n+1$.
    \STATE $\quad$- Save the results.
  \ENDWHILE
\end{algorithmic}
\end{algorithm}</pre>
</div>
</div>
<div class="paragraph">
<p>For reasons of visibility, certain points have been omitted, such as the calculation of the Lagrange multiplier in the case of gradient descent, or certain coefficients in the case of null space gradient flow. The various results obtained are saved after each iteration in a csv file for all cost, volume and \(H^1\)-norm functions, etc. For fields and meshes, paraview files are also exported after each iteration.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.cemosis.fr" class="icon">
            <img src="../_/img/logoCemosisTransparent.png" alt="Cemosis">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.cemosis.fr" target="_blank" rel="noopener">Projects Documentation</a></li>
          <li><a href="https://join.slack.com/t/feelpp/shared_invite/zt-2qe0q9hw-4pVbhohCXUE6Po9Ma8dbiQ" target="_blank" rel="noopener">Forums(Slack)</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.cemosis.fr" target="_blank" rel="noopener">Cemosis</a></li>
          <li><a href="https://www.cemosis.fr/news" target="_blank" rel="noopener">News</a></li>
          <li><a href="https://www.cemosis.fr/projects" target="_blank" rel="noopener">Projects</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.feelpp.org" target="_blank" rel="noopener">Feel++ Documentation</a></li>
          <li><a href="http://docs.feelpp.org/user/">Get Started</a></li>
          <li><a href="http://docs.feelpp.org/user//install/distributions/">Downloads</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/cemosis.fr" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/cemosis" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/cemosis" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Cemosis, Université de Strasbourg</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.cemosis.fr/terms-of-use">Terms of Use</a>
        <a href="https://www.cemosis.fr/privacy-policy">Privacy Policy</a>
        <a href="https://www.cemosis.fr/cookie-policy">Cookie Policy</a>
        <a href="https://www.cemosis.fr/support-policy">Support Policy</a>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>


<script async src="../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../_/js/vendor/fontawesome.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>


<script type="text/javascript">
function toggleFullScreen() {
   var doc = window.document;
   var docEl = doc.documentElement;

   var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
   var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

   if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
       requestFullScreen.call(docEl);
   }
   else {
       cancelFullScreen.call(doc);
   }
}
</script>
  </body>
</html>
