<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Theory of Geometric Shape Optimisation :: Feel++ ShapO // Docs</title>
    <link rel="canonical" href="https://feelpp.github.io/feelpp-shapo/shapo/theorie.html">
    <meta name="description" content="Geometric Shape Optimisation theory">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<script>!function(l,p){if(l.protocol!==p&&l.host=="docs.antora.org"){l.protocol=p}else if(/\.gitlab\.io$/.test(l.host)){l.replace(p+"//docs.antora.org"+l.pathname.substr(l.pathname.indexOf("/",1))+l.search+l.hash)}}(location,"https:")</script>

<script src="../_/js/vendor/tabs-block-extension.js"></script>
<script src="../_/js/vendor/tabs-block-behavior.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']],
    processEscapes: true,
    processEnvironments: true,
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },

  TeX: {
      Macros: {
      RR: "{\\mathbb R}",
      NN: "{\\mathbb N}",
      Nso: "{N_{\\mathrm{so}}}",
      Nma: "{N_{\\mathrm{ma}}}",
      Nno: "{N_{\\mathrm{no}}}",
      Ne: "{N_{\\mathrm{e}}}",
      Ilag: ["{\\mathcal{I}^{\\mathrm{lag}}_{#1}}",1],
      calTh: "{\\mathcal{T}_h}",
      Ck: ["{\\mathcal{C}^{#1}}",1],
      Pk: ["{\\mathcal{P}^{#1}}",1],
      Qk: ["{\\mathcal{Q}^{#1}}",1],
      Pch: ["{P^{#1}_{c,h}}",1],
      Pcho: ["{P^{#1}_{c,h,0}}",1],
      Qch: ["{Q^{#1}_{c,h}}",1],
      Ich: ["{\\mathcal{I}^{#1}_{c,h}#2}",2],
      poly: ["{\\mathbb{#1}}",1],
      nf: "{n_f}",
      ngeo: "{n_{\\mathrm{geo}}}",
      geo: "{\\mathrm{geo}}",
      card: ["{\\operatorname{card}(#1)}",1],
      dim: ["{\\operatorname{dim}(#1)}",1],
      opdim: "{\\operatorname{dim}}",
      card: ["{\\operatorname{card}(#1)}",1],
      poly: ["{\\mathbb{#1}",1],
      R: ["{\\mathbb{R}^{#1}}",1],
      set: ["{\\left\\{#1\\right\\}}",1],
      diam: "{\\operatorname{diam}}",
      jump: ["{[\\![ #1 ]\\!]}",1],
      Next: "{\\mathrm{n}}",
      essinf: "{\\operatorname{ess}\\, \\operatorname{inf}}",
      tr: "{\\operatorname{tr}}",
      Id: "{\\mathcal{I}}",
      disp: ["{\\mathbf{#1}}",1],
      stresst: ["{\\mathbf{\\sigma(#1)}}",1],
      deformt: ["{\\mathbf{\\varepsilon(#1)}}",1],
      domain: "{\\Omega}",
      prect: ["{\\left\\(#1\\right\\)}",1],
      ds: "",
      bold: ["{\\bf #1}",1],
      p: "{\\mathrm{p}}",
      q:"{\\mathbf{q}}",
      n:"{\\mathbf{n}}",
      T:"{\\mathcal{T}}",
      F:"{\\mathcal{F}}",
      P:"{\\mathcal{P}}",
      v:"{\\mathbf{v}}"
  },
  extensions: ["mhchem.js"] }
});
</script>
<!--<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML"></script>-->
<!-- <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script> -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML'>
</script>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>-->

<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" crossorigin="anonymous"></script>-->
<script>var uiRootPath = '../_'</script>

  </head>
  <body class="article">
<header class="header">
  <nav class="navbar  navbar-expand-sm bg-dark navbar-dark">
    <div class="navbar-brand">
      <div class="navbar-item feelpp-logo">
        <a href="https://feelpp.github.io/feelpp-shapo"><img src="../_/img/feelpp-logo.svg" alt="Feel++ logo"/></a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item search hide-for-print">
          <form class="search">
            <i class="fa-solid fa-search"></i>
            <input type="text" placeholder="Search Feel++ ShapO // Docs" class="query" id="search-query">
          </form>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Manuals</div>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.feelpp.org/user/">User</a>
            <a class="navbar-item" href="https://docs.feelpp.org/dev/">Developer</a>
            <a class="navbar-item" href="https://docs.feelpp.org/toolbox/">Toolbox</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link" data-title="Support">
            <span class="icon"><img src="../_/img/octicons-24.svg#view-comment-discussion"></span>
          </div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item has-icon" href="https://join.slack.com/t/feelpp/shared_invite/zt-2qe0q9hw-4pVbhohCXUE6Po9Ma8dbiQ" target="_blank" rel="noopener">
              <span class="icon"><img src="../_/img/slack-icon.svg"></span>
              <span>Chat</span>
            </a>
            <a class="navbar-item has-icon" href="https://github.com/orgs/feelpp/discussions" target="_blank" rel="noopener">
              <span class="icon"><img src="../_/img/octicons-16.svg#view-discussion-closed"></span>
              <span>Discussions</span>
            </a>
            <a class="navbar-item has-icon" href="https://github.com/feelpp" target="_blank" rel="noopener">
              <span class="icon"><img src="../_/img/octicons-16.svg#view-mark-github"></span>
              <span>Source</span>
            </a>
            <a class="navbar-item has-icon" href="https://twitter.com/feelpp" target="_blank" rel="noopener">
              <span class="icon"><img src="../_/img/octicons-16.svg#view-hash"></span>
              <span>Tweets</span>
            </a>
            <a class="navbar-item has-icon" href="https://github.com/feelpp/book.feelpp.org/issues/new">
              <span class="icon"><img src="../_/img/octicons-16.svg#view-bug"></span>
              <span>Issues</span>
            </a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable download-item">
        </div>
        <div class="navbar-item">
          <a class="navbar-brand"  href="https://www.cemosis.fr">
            <img class="cemosis-logo"  src="../_/img/cemosis-logo.svg" alt="Cemosis logo"/>
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<a href="#" class="menu-expand-toggle"></a>
<div class="nav-container" data-component="shapo" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Feel++ ShapO</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text">Feel++ project</span>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Shape Optimisation</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Feel++ ShapO</span>
    <span class="version"></span>
  </div>
  <ul class="components">
      <li class="component is-current">
        <a class="title" href="index.html">Feel++ ShapO</a>
      </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
    <a href="index.html" class="home-link"></a>
  <nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Feel++ ShapO</a></li>
    <li><a href="theorie.html">Theory of Geometric Shape Optimisation</a></li>
  </ul>
</nav>

  
    <div class="edit-this-page"><a href="https://github.com/feelpp/feelpp-shapo/edit/master/docs/modules/ROOT/pages/theorie.adoc">Edit this Page</a></div>
  
  <div class="page-downloads">
  <span class="label">Download as</span>
  <ul class="download-options">
    <li>
      <a onclick="print(this)" href="#" data-toggle="tooltip" data-placement="left" title="Print to PDF"
         class="pdf-download">
        <img class="pdf-file-icon icon" src="../_/img/pdf.svg"/> .pdf
      </a>
    </li>
  </ul>
</div>
</div>

  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Theory of Geometric Shape Optimisation</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_definitions">1.1. Definitions</a></li>
<li><a href="#_derivation_of_integrals">1.2. Derivation of integrals</a></li>
<li><a href="#_derivation_of_domain_dependent_functions_and_equations_ceas_method">1.3. Derivation of domain-dependent functions and equations: Cea&#8217;s method</a></li>
</ul>
</li>
<li><a href="#_solution_methods">2. Solution methods</a>
<ul class="sectlevel2">
<li><a href="#_solution_by_a_gradient_descent_method">2.1. Solution by a gradient descent method</a></li>
<li><a href="#_null_space_gradient_flow">2.2. Null Space Gradient Flow</a></li>
</ul>
</li>
<li><a href="#_references_on_geometric_shape_optimisation">References on geometric shape optimisation</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This introduction to geometric shape optimisation is based on Lucas Palazzolo&#8217;s course. For more details, see <a href="#internship_Palazzolo">[internship_Palazzolo]</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Shape optimization is a field of study that focuses on finding the best possible shape for a given object or system in order to optimize certain performance criteria or objectives which are typically a function of differential equations defined on the shape itself. The optimisation problem can be written as</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \inf_{\Omega \in \Omega_{ad}}J(\Omega, u(\Omega))
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>with \(u\) solution of a PDE defined on the domain \(\Omega\).</p>
</div>
<div class="paragraph">
<p>Geometric shape optimization focuses on directly modifying the shape of an object to achieve the desired objectives via a non-parametric deformation field \(\theta\). It involves manipulating the geometry of the object to improve its performance. We consider a reference domain \(\Omega_0\), which we assume to be a regular bounded open subset of \(\mathbb{R}^N\). Let \(\partial \Omega_0\) the boundary of this domain. We denote with \(\theta\) the deformation applied to the initial domain to get the new domain \(\Omega\), i.e.</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \Omega = (\textrm{Id} + \theta)(\Omega_0).
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>This deformation is illustrated in the following figure where a deformation field is applied to a reference domain.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/shape_opti_principle.png" alt="shape opti principle" width="700">
</div>
<div class="title">Figure 1. Shape optimisation principle : the \(\Omega_0\) domain is deformed according to a deformation field \(\theta\) such that the new \(\Omega\) domain is given by \(\Omega = (\textrm{Id} + \theta)(\Omega_0)\).</div>
</div>
<div class="paragraph">
<p>In the pursuit of finding shape derivative of the cost function, a well-known method called Cea&#8217;s method, developed by Cea in <a href="#cea_conception_1986">[cea_conception_1986]</a>, proves to be both simple and effective. However, it should be noted that Cea&#8217;s method is considered a <em>formal</em> approach as it relies on certain assumptions regarding the regularity of the problem&#8217;s data. We look at the numerical solution of these two problems using two numerical methods : the gradient descent <a href="#allaire_conception_2006">[allaire_conception_2006]</a> and the null space gradient flow <a href="#feppon_shape_2019">[feppon_shape_2019]</a>.</p>
</div>
<div class="paragraph">
<p>The gradient descent method is a classic method for solving geometric shape optimisation problems. In this method, an initial shape is iteratively modified by moving in the direction of the negative gradient of the objective function. The process continues until convergence to an optimal shape is achieved. The null space gradient flow method involves finding the shape that minimizes the objective function while satisfying a set of constraints. It utilizes the notion of null space and range space directions to guide the shape optimization process.</p>
</div>
<div class="sect2">
<h3 id="_definitions"><a class="anchor" href="#_definitions"></a>1.1. Definitions</h3>
<div class="paragraph">
<p>As presented in <a href="#allaire_conception_2006">[allaire_conception_2006]</a>, in order to describe the set of admissible forms, we need to introduce the following set of diffeomorphisms.</p>
</div>
<div id="setT" class="sidebarblock def">
<div class="content">
<div class="title">Definition : Deformation of the identity</div>
<div class="paragraph">
<p>We define a space of diffeomorphisms on \(\mathbb{R}^N\) (which can be seen as a deformation of the identity) by</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\mathcal{T} = \left\{ T \mid (T-\textrm{Id})\in W^{1,\infty}(\Omega, \mathbb{R}^N) \text{ and } (T^{-1}-\textrm{Id})\in W^{1,\infty}(\Omega, \mathbb{R}^N)  \right\}.
\end{equation*}\]
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now we can clarify the admissible shapes obtained by deformation of \(\Omega_0\), that are defined by the following set.</p>
</div>
<div class="sidebarblock def">
<div class="content">
<div class="title">Definition : The set of admissible shapes</div>
<div class="paragraph">
<p>The set of <em>admissible shapes</em> obtained by deformation of \(\Omega_0\) is given by</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    C(\Omega_0)=\left\{\Omega \subset \mathbb{R}^N \mid \exists T \in \mathcal{T}, \quad \Omega=T(\Omega_0) \right\},
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>where \(\mathcal{T}\) is defined by <a href="#setT">Definition : Deformation of the identity</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In view of the above definitions, it is natural to consider the vector field \(\theta\) such as</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    T = \textrm{Id} + \theta \qquad \text{with} \qquad \theta \in W^{1,\infty}(\Omega, \mathbb{R}^N) ~ \text{and} ~ T \in \mathcal{T}.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>In order to be able to define a differentiability notion in \(\Omega_0\) with respect to \(\theta\), we need the following lemma which guarantees that if \(\theta\) is small enough then \(T= \textrm{Id} + \theta\) is indeed a diffeomorphism which belongs to \(\mathcal{T}\).</p>
</div>
<div class="sidebarblock lem">
<div class="content">
<div class="title">Lemma 1</div>
<div class="paragraph">
<p>For all \(\theta \in W^{1,\infty}(\Omega, \mathbb{R}^N)\) that verify \(\|\theta\|_{W^{1,\infty}(\Omega, \mathbb{R}^N)}&lt;1\), the map \(T=\textrm{Id}  +\theta\) is a bijection of \(\mathbb{R}^N\) that belongs to \(\mathcal{T}\) defined by <a href="#setT">Definition : Deformation of the identity</a>.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Proof</summary>
<div class="content">
<div class="paragraph">
<p>See [<a href="#allaire_conception_2006">[allaire_conception_2006]</a>, Lemma 6.13]</p>
</div>
</div>
</details>
<div class="paragraph">
<p>All that remains is to define the notion of differentiability in relation to the domain that we call shape derivation or differentiability with respect to the domain. The following definition applies to differentiability in the Fréchet sense as well as in the Gâteaux sense.</p>
</div>
<div id="difdomaine" class="sidebarblock def">
<div class="content">
<div class="title">Definition : Differentiability with respect to the domain</div>
<div class="paragraph">
<p>Let \(J(\Omega)\) a map such that \(J : C(\Omega_0) \to \mathbb{R}\). \(J\) is said to be differentiable with respect to the domain on \(\Omega_0\) if</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \theta \mapsto J\left((\textrm{Id} +\theta)(\Omega_0)\right)
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>is differentiable in 0 in the Banach space \(W^{1,\infty}(\Omega, \mathbb{R}^N).\)</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Let us introduce some notation to define the matrix scalar product.</p>
</div>
<div class="sidebarblock def">
<div class="content">
<div class="title">Definition : Matrix scalar product</div>
<div class="paragraph">
<p>Let \(A\) and \(B\) be two real matrices of dimension \(N\). We define the scalar product of two matrices as</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    A : B = tr(A^TB).
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>and we will note thereafter \(\|\cdot \|\) the associated norm.</p>
</div>
</div>
</div>
<div class="sidebarblock def">
<div class="content">
<div class="title">Definition</div>
<div class="paragraph">
<p>We denote</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    H^{k}_{\Gamma}(\Omega) = \left\{v \in H^{k}(\Omega) \mid v|_{\Gamma} = 0 \right\},
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>the set of functions belonging to \(H^{k}(\Omega)\) and which vanish on \(\Gamma\).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_derivation_of_integrals"><a class="anchor" href="#_derivation_of_integrals"></a>1.2. Derivation of integrals</h3>
<div class="paragraph">
<p>In this subsection, <a href="#difdomaine">Definition : Differentiability with respect to the domain</a> of differentiability with respect to the domain will be applied to volume or surface integrals. The paragraph will be brief, for more details we point the reader to <a href="#allaire_conception_2006">[allaire_conception_2006]</a>. We denote \(n\) as the unit normal pointing outwards to the domain.</p>
</div>
<div id="Prop:diffJOmega" class="sidebarblock prop">
<div class="content">
<div class="title">Proposition 1</div>
<div class="paragraph">
<p>Let \(\Omega_0\) be a regular bounded open subset of \(\mathbb{R}^N\). Let \(f \in W^{1,1}(\mathbb{R}^N)\) and \(J\) be the map of \(C(\Omega_0)\) in \(\mathbb{R}\) defined by</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    J(\Omega)=\int_{\Omega}f.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>Then \(J\) is differentiable in \(\Omega\) and for all \(\theta \in W^{1,\infty}(\Omega,\mathbb{R}^N)\) we have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    DJ(\Omega)(\theta)=\int_{\Omega}\nabla \cdot \left(\theta f\right) = \int_{\partial \Omega}\theta\cdot n f.
\end{equation*}\]
</div>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Proof</summary>
<div class="content">
<div class="paragraph">
<p>See [<a href="#allaire_conception_2006">[allaire_conception_2006]</a>, Proposition 6.22]</p>
</div>
</div>
</details>
<div id="Prop:diffJpartialOmega" class="sidebarblock prop">
<div class="content">
<div class="title">Propostion 2</div>
<div class="paragraph">
<p>Let \(\Omega_0\) be a regular bounded open subset of \(\mathbb{R}^N\). Let \(f \in W^{2,1}(\mathbb{R}^N)\) and \(J\) be the map of \(C(\Omega_0)\) in \(\mathbb{R}\) defined by</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    J(\Omega)=\int_{\partial \Omega}f.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>Then \(J\) is differentiable in \(\Omega\) and for all \(\theta \in C^1(\mathbb{R}^N,\mathbb{R}^N)\) we have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
DJ(\Omega)(\theta)=\int_{\partial \Omega}\left(\nabla f \cdot \theta + f(\nabla \cdot \theta)-f(\nabla\theta n \cdot n)\right) = \int_{\partial \Omega}\theta \cdot n \left(\frac{\partial f}{\partial n}+(\nabla \cdot n)f\right).
\end{equation*}\]
</div>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Proof</summary>
<div class="content">
<div class="paragraph">
<p>See [<a href="#allaire_conception_2006">[allaire_conception_2006]</a>, Proposition 6.24 &amp; Lemma 6.25]</p>
</div>
</div>
</details>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that we need \(\theta \in C^1(\mathbb{R}^N,\mathbb{R}^N)\). Indeed, we need to define the trace of \(\nabla \theta\) on \(\partial \Omega\), and therefore the hypothesis \(\theta \in W^{1,\infty}(\Omega,\mathbb{R}^N)\) is not sufficient.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_derivation_of_domain_dependent_functions_and_equations_ceas_method"><a class="anchor" href="#_derivation_of_domain_dependent_functions_and_equations_ceas_method"></a>1.3. Derivation of domain-dependent functions and equations: Cea&#8217;s method</h3>
<div class="paragraph">
<p>In the following, we consider a cost function \(J\) (depending on a domain \(\Omega\)) which we wish to minimize (or maximize) by finding the shape of the optimal domain. Additionally, we assume that \(J\) relies on a variable \(u\), which is a solution to a specific differential equation defined on the domain \(\Omega\). Consequently, it becomes necessary to differentiate the cost function and the differential equation with respect to the domain.</p>
</div>
<div class="paragraph">
<p>A simple and efficient method for calculating values is the Cea&#8217;s method developed in <a href="#cea_conception_1986">[cea_conception_1986]</a>. This method also allows us to "guess" the definitions of the adjoint state \(p\). However, it is important to note that this method is <em>formal</em>, as it relies on certain assumptions about the regularities of the problem&#8217;s data, particularly concerning the solution \(u\). For more rigorous calculations, the use of Eulerian and Lagrangian derivatives, as described in <a href="#allaire_conception_2006">[allaire_conception_2006]</a>, becomes necessary. This method incorporates the concepts of the primal problem or state problem, the dual problem or adjoint problem, and the Lagrangian. The problem is presented as follows.</p>
</div>
<div class="paragraph">
<p><strong>Cost Function :</strong> Let \(J\) be a (domain-dependent) cost function that we seek to minimize (or maximize) such that</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
 \begin{array}{rcl}
J:C(\Omega_0)&amp;\to&amp; \mathbb{R}\\
\Omega &amp;\mapsto &amp;J(\Omega, u(\Omega)),
\end{array}
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>where \(J\) <em>depends</em> of the solution \(u\) of a differential equation. For ease of reading, we omit the \(u\) in the notation of the cost function. We seek to solve the following problem</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \inf_{\Omega \in \Omega_{ad}} J(\Omega),
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>where \(\Omega_{ad}\) corresponds to the admissible domains.</p>
</div>
<div class="paragraph">
<p><strong>Primal Equation :</strong> Let \(u\) be the solution of a problem, called a state problem or primal problem. Let \(E\) be the map governing the variational formulation associated with the primal problem such that</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\begin{array}{rcl}
E:V\times V&amp;\to&amp; \mathbb{R}\\
(v,q) &amp;\mapsto &amp;E(v,q),
\end{array}
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>where \(V\) is, in our case, a Sobolev space. Then, by definition of the weak formulation, for all \(q \in V\) we have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    E(u,q)=0,
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>with \(u\) the solution of the primal problem.</p>
</div>
<div class="paragraph">
<p><strong>The Lagrangian :</strong> The Cea&#8217;s method is based on duality. For this purpose, we consider the primal equation as a constraint and introduce the following Lagrangian.</p>
</div>
<div class="sidebarblock def">
<div class="content">
<div class="title">Definition : Lagrangian without Dirichlet condition</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\begin{array}{rcl}
\mathcal{L}:C(\Omega_0)\times V\times V&amp;\to&amp; \mathbb{R}\\
(\Omega, v,q) &amp;\mapsto &amp;J(\Omega) + E(v,q),
\end{array}
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>which is the sum of the objective function and the variational formulation of the primal equation.</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We must not forget that \(J\) also depends on \(v\) ! It is absolutely important for the following to consider that the three variables are independent of each other. Thus, the space \(V\) must be independent of the domain \(\Omega\).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the state problem has a Dirichlet condition, we must add another Lagrange multiplier, as explained in <a href="#allaire_conception_2006">[allaire_conception_2006]</a>.</p>
</div>
<div class="sidebarblock def">
<div class="content">
<div class="title">Deifnition : Lagrangian with Dirichlet condition</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\begin{array}{rcl}
\mathcal{L}:C(\Omega_0)\times V\times V\times V&amp;\to&amp; \mathbb{R}\\
(\Omega, v,q, \psi) &amp;\mapsto &amp;J(\Omega) + E(v,q) + F(v,\psi),
\end{array}
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>where \(F\) represents the constraint associated with the Dirichlet condition.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>To simplify the following, we will assume that \(E\) and \(F\) are bilinear. We then quickly obtain the different equations and the gradient of \(J\) (assuming all the necessary regularities).</p>
</div>
<div id="primalderivative" class="sidebarblock prop">
<div class="content">
<div class="title">Proposition : Primal problem thanks to the Lagrangian</div>
<div class="paragraph">
<p>For all \((q,\phi) \in V^2\)</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}
    \left\langle\frac{\partial \mathcal{L}}{\partial q}(\Omega, u, q),\phi \right\rangle = 0,
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>with \(u\) solution of the primal problem, i.e. for all \(\phi \in V\)</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}
    E(u,\phi) = 0,
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>by bilinearity of \(E\). This results in \(u\) being the solution to the variational formulation of the primal problem.</p>
</div>
</div>
</div>
<div id="dualderivative" class="sidebarblock prop">
<div class="content">
<div class="title">Proposition : Dual problem thanks to the Lagrangian</div>
<div class="paragraph">
<p>For all \((v,\phi)\in V^2\), we have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}
    \left\langle \frac{\partial \mathcal{L}}{\partial v}(\Omega, v, p),\phi \right\rangle = 0,
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>with \(p\) solution of the dual problem, i.e. for all \(\phi \in V\)</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}
    E(\phi, p)+ \frac{\partial J}{\partial v}(\Omega)(\phi) = 0,
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>by bilinearity of \(E\) and by the fact that \(J\) also depends on \(v\). This results in \(p\) being solution to the weak formulation of the dual problem.</p>
</div>
</div>
</div>
<div id="lagmethod:gradientJ" class="sidebarblock prop">
<div class="content">
<div class="title">Proposition : Differential of the cost fucntion thanks to the Lagrangian</div>
<div class="paragraph">
<p>For all \(\theta\) in V, we have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}
    DJ(\Omega)(\theta)=\frac{\partial \mathcal{L}}{\partial \Omega}(\Omega, u(\Omega), p(\Omega))(\theta).
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>with \(u\) and \(p\) solution of the primal and dual problem.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Proof</summary>
<div class="content">
<div class="paragraph">
<p>Since \(u(\Omega)\) is a solution of the primal problem and thus vanishes the weak formulation, we have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \mathcal{L}(\Omega, u(\Omega), q) = J(\Omega) \qquad \forall q\in V.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>The key point is that this is valid for all \(q\) in \(V\). Thus, we can take \(q\) in particular in the following as the solution of the dual problem (similarly for Lagrange multipliers in the case of Dirichlet conditions). To emphasize the dependence of the solution \(u\) on the domain, we write \(u(\Omega)\). By independence of the variable \(q\) with respect to \(\Omega\) and deriving this relation using chain rule (always assuming that we have the necessary regularities to do so), we get</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    DJ(\Omega)(\theta) = \frac{\partial \mathcal{L}}{\partial \Omega}\left(\Omega, u(\Omega), q\right)(\theta) + \left\langle \frac{\partial \mathcal{L}}{\partial v}\left(\Omega, u(\Omega), q\right), u'(\Omega)(\theta) \right\rangle.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>By taking \(q=p(\Omega)\) solution of the dual problem, the last term vanishes. Finally, we come to</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}
    DJ(\Omega)(\theta)=\frac{\partial \mathcal{L}}{\partial \Omega}(\Omega, u(\Omega), p(\Omega))(\theta).
\end{equation}\]
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solution_methods"><a class="anchor" href="#_solution_methods"></a>2. Solution methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To minimize the cost function \(J(\Omega)\), we differentiate according to the variable \(\theta\) which parametrizes the form \(\Omega=(\textrm{Id}+\theta)(\Omega_0)\). In the various problems we study, certain boundaries will be assumed to be fixed, i.e. non-deformable, and noted \(\Gamma_{fixed}\). We denote \(\Gamma\) the deformable part of \(\partial \Omega\), thus</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \partial \Omega = \Gamma \cup \Gamma_{fixed}.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>In <a href="#allaire_conception_2006">[allaire_conception_2006]</a> a method is quickly defined for all cost functions whose derivative can be written as follows</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}\label{eq:DJ}
 DJ(\Omega)(\theta)=\int_{\Gamma} \theta \cdot n G(\Omega),
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>where \(G(\Omega)\) is a function (which depends of the state and of the adjoint) which is called the shape gradient. In the following, we will assume that we are studying an optimisation problem with an equality constraint in order to preserve the volume of the domain.</p>
</div>
<div id="eq:Omegad" class="sidebarblock def">
<div class="content">
<div class="title">Definition : Set of admissible domains</div>
<div class="paragraph">
<p>The set of admissible domains, \(\Omega_{ad}\), is given by</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}\label{eq:Omegad}
\Omega_{ad}=\left\{\Omega \in C(\Omega_0) \mid \Gamma_{fixed}  \subset \partial \Omega, ~ g(\Omega)= 0\right\}
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>with
\(g\) the equality constraint for the volume conservation, written as</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \begin{array}{rcl}
            g:V&amp;\to&amp; \mathbb{R}\\
            \theta &amp;\mapsto &amp;|(\textrm{Id}  + \theta)(\Omega)|-|\Omega_0|.
            \end{array}
\end{equation*}\]
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By abuse of notation, the most of the time we write \(g(\Omega)\) instead of \(g(\theta)\).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The non-deformation constraints the boundaries \(\Gamma_{fixed}\) are taken into account by simply imposing</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\theta=0 \qquad \text{on} \qquad \Gamma_{fixed},
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>i.e. we impose a null displacement field at these boundaries.</p>
</div>
<div id="eq:Dg" class="sidebarblock prop">
<div class="content">
<div class="title">Proposition : Differential of the volume constraint</div>
<div class="paragraph">
<p>The differential of \(g\), definined in <a href="#eq:Omegad">Definition : Set of admissible domains</a>, is given by</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \begin{array}{rcl}
            Dg(\Omega):V&amp;\to&amp; \mathbb{R}\\
            \theta &amp;\mapsto &amp;\int_{\Gamma}\theta \cdot n.
            \end{array}
\end{equation*}\]
</div>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Proof</summary>
<div class="content">
<div class="paragraph">
<p>By using <a href="#Prop:diffJOmega">Proposition 1</a> on \(g\).</p>
</div>
</div>
</details>
<div class="paragraph">
<p>Two methods will be presented to solve this type of problems: gradient descent and Null Space Gradient Flow.</p>
</div>
<div class="sect2">
<h3 id="_solution_by_a_gradient_descent_method"><a class="anchor" href="#_solution_by_a_gradient_descent_method"></a>2.1. Solution by a gradient descent method</h3>
<div class="paragraph">
<p>The gradient descent (GD) method is an optimization technique used to minimize a function iteratively. By taking a new form, \(\Omega_t\), such as</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\Omega_t=(\textrm{Id}+\theta_t)(\Omega_0) \qquad \text{with} \qquad \theta_t = -t G(\Omega_0)n ,
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>where \(t&gt;0\), we have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
 DJ(\Omega_0)(\theta_t)=-t\int_{\Gamma_0}G(\Omega_0)^2 &lt;0.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>Thus, for a sufficiently small step size \(t\), we have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
 J(\Omega_{t}) &lt; J(\Omega_0) \qquad \text{if} \qquad G(\Omega_0)\ne 0.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>It can be noted that to have \(DJ(\Omega_0)(\theta)&lt;0\), we need to choose \(\theta \cdot n &gt;0\). Let \(l \in \mathbb{R}\) a Lagrange multiplier for the volume constraint. The domain optimality condition, by using the Lagrange multiplier theorem, can be seen as</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}\label{eq:Lm}
DJ(\Omega)(\theta)+l Dg(\Omega)(\theta) = \int_{\Gamma} \theta \cdot n \left[l +G(\Omega)\right]  = 0.
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p><strong>Numerical implementation :</strong> For the numerical implementation, a domain sequence, \(\Omega_k\), is computed which verifies the following constraints</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
   \partial \Omega_k = \Gamma_k \cup \Gamma_{fixed}.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>Let \(t&gt;0\) a fixed descent step,  as explained in <a href="#allaire_conception_2006">[allaire_conception_2006]</a> the following iterations are performed until convergence, for \(k\geq 0\) :</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\Omega_{k+1} = (\textrm{Id} + \theta_k)(\Omega_k)
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>with</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\theta_k = \begin{cases}
-t\left[l_k+G(\Omega_k)\right]n_k &amp;\qquad \text{on }  \Gamma_k \\
0 &amp;\qquad \text{on } \Gamma_{fixed}
 \end{cases}
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>where \(n_k\) is the normal vector of \(\partial \Omega_k\) and \(l_k \in \mathbb{R}\) a Lagrange multiplier. To extend the trace of \(\theta_k\) on \(\partial \Omega_k\) inside \(\Omega_k\), we can solve the following system</p>
</div>
<div class="sidebarblock prob">
<div class="content">
<div class="title">Expansion PDE for GD</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\begin{cases}
-\Delta\theta_k = 0 &amp;\qquad \text{on } \Omega_k \\
\theta_k = 0 &amp;\qquad \text{on } \Gamma_{fixed} \\
\theta_k = -t\left[l_k+G(\Omega_k)\right]n_k &amp;\qquad \text{on } \Gamma_k.
 \end{cases}
\end{equation*}\]
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once we know \(\theta_k\) about \(\Omega_k\), we can deform the whole mesh to obtain a new one of the domain \(\Omega_{k+1}\). It will be advisable to remesh the domain from time to time when the mesh becomes of poor quality measure in \(\texttt{Feel++}\) (which leads to numerical errors).</p>
</div>
<div class="paragraph">
<p>For a higher regularity, we can solve the following system</p>
</div>
<div id="regexpgd" class="sidebarblock prob">
<div class="content">
<div class="title">Regularised expansion PDE for GD</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\begin{cases}
-\Delta\theta_k = 0 &amp;\qquad \text{on } \Omega_k \\
\theta_k = 0 &amp;\qquad \text{on } \Gamma_{fixed} \\
\frac{\partial \theta_k}{\partial n} = -t\left[l_k+G(\Omega_k)\right]n_k &amp;\qquad \text{on } \Gamma_k.
 \end{cases}
\end{equation*}\]
</div>
</div>
</div>
</div>
<div class="sidebarblock prop">
<div class="content">
<div class="title">Proposition : Descent direction of <a href="#regexpgd">Regularised expansion PDE for GD</a></div>
<div class="paragraph">
<p>The <a href="#regexpgd">Regularised expansion PDE for GD</a> still provides a descent direction.</p>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Proof</summary>
<div class="content">
<div class="paragraph">
<p>We have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}
    DJ(\Omega_k)(\theta_k) + l_k Dg(\Omega_k)(\theta_k) &amp;= \int_{\Gamma_k}\theta_k \cdot n_k \left[l_k + G(\Omega_k)\right]\\
    &amp;=t^{-1}\int_{\Omega_k}\Delta\theta_k \cdot \theta_k - t^{-1}\int_{\Gamma_k}\theta_k \cdot \nabla \theta_k n_k,
\end{align*}\]
</div>
</div>
<div class="paragraph">
<p>because of the boundary conditions and the fact that \(\Delta \theta_k =0\). By integrating, we finally obtain that</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
DJ(\Omega_k)(\theta_k) + l_k Dg(\Omega_k)(\theta_k) =-t^{-1}\int_{\Omega_k}\|\nabla \theta_k\|^2 \leq 0.
\end{equation*}\]
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>Concerning the choice of the implementation of the Lagrange multiplier, the same model as <em>G.Allaire</em> in <a href="http://www.cmap.polytechnique.fr/~allaire/map562/cantilever.edp">his code</a> will be taken into account (a kind of augmented Lagrangian). We thus have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    l_k = al_{k-1}+b\frac{\int_{\Gamma_k}G(\Omega_k)}{|\Gamma_k|}+c\frac{|\Omega_k|-|\Omega_0|}{|\Omega_0|},
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>with \(a\), \(b\) and \(c\) parameters to be chosen according to the problem studied.</p>
</div>
</div>
<div class="sect2">
<h3 id="_null_space_gradient_flow"><a class="anchor" href="#_null_space_gradient_flow"></a>2.2. Null Space Gradient Flow</h3>
<div class="paragraph">
<p>Null Space Gradient Flow (NSGF), presented in <a href="#feppon_shape_2019">[feppon_shape_2019]</a>, is a new approach to solving constrained optimization problems. Unlike traditional methods, this technique does not require necessarily the adjustment of non-physical parameters, making it highly practical and reliable. Its applicability to shape optimization applications further enhances its usefulness.</p>
</div>
<div class="paragraph">
<p>The key concept behind NSGF is to modify the gradient flow algorithm to accommodate the presence of constraints. This is achieved by solving an Ordinary Differential Equation (ODE) that governs the optimization trajectories, denoted as \(x(t)\). The ODE takes the form:</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\dot x = -\alpha_J \xi_J(x(t)) - \alpha_C \xi_C(x(t))
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>Here, \(\alpha_J\) and \(\alpha_C\) positive parameters, control the influence of the objective function and constraint violation, respectively. \(\xi_J(x)\) and \(\xi_C(x)\) represent the null space and range space directions, respectively. The null space direction, \(\xi_J(x)\), is obtained by projecting the gradient \(\nabla J(x)\) onto the cone of feasible directions, ensuring descent while respecting the constraints. The range space direction, \(\xi_C(x)\), guides the optimization path smoothly towards the feasible region.</p>
</div>
<div class="paragraph">
<p>We consider the case where the optimization takes place on a Hilbert space \(V\) with inner product \(\langle  ., . \rangle_{V}\). The transpose of the differential of a function in infinite dimension is defined as follows.</p>
</div>
<div id="def:DgT" class="sidebarblock def">
<div class="content">
<div class="title">Definition : Transpose</div>
<div class="paragraph">
<p>Let \(g : V \to \mathbb{R}^p\) a differentiable function and \(x\) a point of \(V\). Then, for any \(\mu \in \mathbb{R}^p\) it exists a unique vector \(Dg^T(x)(\mu) \in V\) such as</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \forall \mu \in \mathbb{R}^p \quad \forall \phi \in V \qquad \left\langle Dg^T(x)(\mu), \phi \right\rangle_{V} = \mu^T Dg(x)(\phi).
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>The linear operator \(Dg^T(x) : \mathbb{R}^p \to V\) is called the transpose of \(Dg(x)\).</p>
</div>
</div>
</div>
<div class="paragraph">
<p>For equality constrained problems (see Definition 3.3 in <a href="#feppon_shape_2019">[feppon_shape_2019]</a>) , null space step \(\xi_J\) and range space step \(\xi_C\) are defined as the following.</p>
</div>
<div id="def:xi" class="sidebarblock def">
<div class="content">
<div class="title">Definition : Null space and range space directions</div>
<div class="paragraph">
<p>For any domain \(\Omega\), the null space and range space directions \(\xi_C(\Omega) : \mathbb{R}^N \to \mathbb{R}^N\) and \(\xi_J(\Omega) : \mathbb{R}^N \to \mathbb{R}^N\) are defined by</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}
 \xi_C(\Omega)(X)= &amp;Dg^T(\Omega)\left[(Dg(\Omega) Dg^T(\Omega))^{-1}g(\Omega)\right](X), \\
 \xi_J(\Omega)(X)= &amp;\nabla J(\Omega)(X) - Dg^T(\Omega)\left[(Dg(\Omega)Dg^T(\Omega))^{-1}Dg(\Omega)\nabla J(\Omega)\right](X).
\end{align*}\]
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In order to control the step size \(\|\theta_n\|_{L^{\infty}(\mathbb{R}^N, \mathbb{R}^N)}\) and keep all values of the displacement of the order of the mesh size, the parameters \(\alpha_{J,n}\) and \(\alpha_{C,n}\) are updated dynamically.</p>
</div>
<div class="sidebarblock def">
<div class="content">
<div class="title">Definition :  Parameters of directions</div>
<div class="paragraph">
<p>We consider \(A_J&gt;0\) and \(A_C&gt;0\) two parameters and \(n_0&gt;0\) the \(n_0\)-th iteration. The coefficients are updated at every iteration according to the following rules :</p>
</div>
<div class="stemblock">
<div class="content">
\[ \begin{align*}
          \alpha_{J,n} &amp;= \begin{cases}
            \frac{A_J \texttt{hmin}}{\|\xi_J(\Omega_n)\|_{L^{\infty}}} \qquad \qquad \qquad \qquad \quad ~  n&lt;n_0,\\
            \frac{A_J \texttt{hmin}}{\max\left\{\|\xi_J(\Omega_n)\|_{L^{\infty}},\|\xi_J(\Omega_{n_0})\|_{L^{\infty}}\right\}}  \qquad n\geq n_0,
        \end{cases} \\
        \alpha_{C,n} &amp;= \min\left\{0.9, \frac{A_C \texttt{hmin}}{\max\{\texttt{1e-9}, \|\xi_C(\Omega_n)\|_{L^{\infty}}\}}\right\}.
    \end{align*}\]
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As explained in <a href="#feppon_shape_2019">[feppon_shape_2019]</a>, \(A_J\) and \(A_C\) don&#8217;t need fine tuning. Thus, to obtain a more general algorithm with the least possible parameters, we take \(A_J=A_C=1\).</p>
</div>
<div class="sidebarblock prop">
<div class="content">
<div class="title">Proposition : Bounded directions</div>
<div class="paragraph">
<p>These normalizations ensure that the infinite norm of the various terms is less than the smallest mesh size, i.e.</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \forall n\geq 0 \quad \|\alpha_{J,n}\xi_J(\Omega_n)\|_{L^{\infty}}\leq A_J\texttt{hmin} \quad \text{and} \quad \|\alpha_{C,n}\xi_C(\Omega_n)\|_{L^{\infty}}\leq \min\{\texttt{0.9}, A_C\texttt{hmin}\}.
\end{equation*}\]
</div>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Proof</summary>
<div class="content">
<div class="paragraph">
<p>Trivial.</p>
</div>
</div>
</details>
<div class="paragraph">
<p>The key point of this method is to be able to determine the transpose of the differential of the equality constraint. To do this, consider a Hilbert space \(V=H^1(\mathbb{R}^N)\) such that \(V\subset W^{1,\infty}(\Omega, \mathbb{R}^N)\) with the following scalar product</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \forall (\theta,\theta') \in V^2, \quad \left\langle \theta, \theta'\right\rangle_{V}=\int_{\Omega}\gamma^2 \nabla \theta:\nabla \theta' + \theta \cdot \theta'
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>where the parameter \(\gamma\) is set proportional to the minimum mesh element size.</p>
</div>
<div class="paragraph">
<p>The differential of the cost function is assumed to be of the previous form with \(G(\Omega)\) the shape gradient. Thus, as described in <a href="#feppon_shape_2019">[feppon_shape_2019]</a> Chapter 1 on page 54, the gradient of the cost function, \(\nabla J\), is a regularised extension of \(G(\Omega)n\), i.e</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}\label{eq:gradJ}
   \nabla J(\Omega) = G(\Omega)n \quad \text{on } \Gamma,
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>with \(n\) the external unit normal.</p>
</div>
<div id="eq:DgTpb" class="sidebarblock prop">
<div class="content">
<div class="title">Proposition : Transposition of the differential for volume conservation</div>
<div class="paragraph">
<p>The transposition of <a href="#eq:Dg">Proposition : Differential of the volume constraint</a> is given by</p>
</div>
<div class="stemblock">
<div class="content">
\[   \begin{equation}\label{eq:DgTpb}
       \begin{cases}
-\gamma^2\Delta(Dg^T(\Omega)(e_1)) + Dg^T(\Omega)(e_1) = 0 &amp;\qquad \text{in } \Omega, \\
\frac{\partial Dg^T(\Omega)(e_1)}{\partial n} = \frac{1}{\gamma^2}n &amp;\qquad \text{on } \Gamma,\\
\frac{\partial Dg^T(\Omega)(e_1)}{\partial n} = 0 &amp;\qquad \text{on } \Gamma_{fixed}.
 \end{cases}
   \end{equation}\]
</div>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Proof</summary>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s determine \(Dg^T\). First at all, let \(e={e_1}\) be the canonical basis of \(\mathbb{R}\). Then, by linearity of differential, we have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
   \forall \mu \in \mathbb{R} \quad  Dg^T(\Omega)(\mu) =\mu_1 Dg^T(\Omega)(e_1).
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>with \(\mu=\mu_1 e_1\). Then, by taking \(\mu=e_1\), for all \(\phi \in V\) and by using  <a href="#def:DgT">Definition : Transpose</a>, we obtain</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
 \left\langle Dg^T(\Omega)(e_1), \phi \right\rangle_{V} = e_1 Dg(\Omega)(\phi),
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>in other words,</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
  \int_{\Omega}\gamma^2 \nabla \left(Dg^T(\Omega)(e_1)\right):\nabla \phi + Dg^T(\Omega)(e_1)\cdot \phi = \int_{\Gamma}\phi \cdot n.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>We want to solve</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \int_{\Omega}\gamma^2 \nabla U : \nabla \phi + U \cdot \phi = \int_{\Gamma}\phi \cdot n,
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>for all \(\phi\) in \(V\) with \(U=Dg^T(\Omega)(e_1)\). By using a integration of parts formula, it follows that</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
    \int_{\Omega}\left(-\gamma^2 \Delta U + U \right)\cdot \phi = \int_{\Gamma}\left(I-\gamma^2 \nabla U\right)n \cdot \phi -\int_{\Gamma_{fixed}}\gamma^2\nabla U n \cdot \phi.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>By taking \(\nabla U n = I\frac{n}{\gamma^2}\) on \(\Gamma\) and \(\nabla U n = 0\) on \(\Gamma_{fixed}\), we therefore need to solve the following problem</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}
    \begin{cases}
-\gamma^2\Delta(Dg^T(\Omega)(e_1)) + Dg^T(\Omega)(e_1) = 0 &amp;\qquad \text{in } \Omega, \\
\frac{\partial Dg^T(\Omega)(e_1)}{\partial n} = \frac{1}{\gamma^2}n &amp;\qquad \text{on } \Gamma,\\
\frac{\partial Dg^T(\Omega)(e_1)}{\partial n} = 0 &amp;\qquad \text{on } \Gamma_{fixed}.
 \end{cases}
\end{equation}\]
</div>
</div>
</div>
</details>
<div class="sidebarblock prop">
<div class="content">
<div class="title">Proposition : Null space and range space directions for volume conservation</div>
<div class="paragraph">
<p>The null space and range space directions, in the case of <a href="#eq:Omegad">Definition : Set of admissible domains</a>, can be written as follow</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}
\xi_J(\Omega)(X)=\nabla J(\Omega)(X) -\frac{\left(\int_{\partial \Omega} \nabla J(\Omega) \cdot n\right)Dg^T(e_1)(X)}{\int_{\Omega}Dg^T(\Omega)\left(e_1\right)\cdot n},
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation}
\xi_C(\Omega)(X)=\left(\frac{g(\Omega)}{\int_{\partial \Omega}Dg^T(\Omega)(e_1)\cdot n}\right)Dg^T(\Omega)\left(e_1\right)(X).
\end{equation}\]
</div>
</div>
</div>
</div>
<details class="proof">
<summary class="title">Proof</summary>
<div class="content">
<div class="paragraph">
<p>By definition of \(g\) and \(Dg\), we have</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*} (Dg(\Omega)Dg^T(\Omega))^{-1}g(\Omega)=\frac{g(\Omega)}{\int_{\partial \Omega}Dg^T(\Omega)(e_1)\cdot n}
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
(Dg(\Omega)Dg^T(\Omega))^{-1}Dg(\Omega)\nabla J(\Omega)=\frac{\left(\int_{\partial \Omega} \nabla J(\Omega) \cdot n\right)}{\int_{\Omega}Dg^T(\Omega)\left(e_1\right)\cdot n}.
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>Thus, the result can be deduced.</p>
</div>
</div>
</details>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All the steps above are valid when there are several equality constraints, i.e. \(g : V \to \mathbb{R}^p\) with \(p\geq 1\). Furthermore, it is possible to extend this method to inequality constraints as explained in <a href="#feppon_shape_2019">[feppon_shape_2019]</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Numerical Implementation :</strong> For the numerical implementation, a domain sequence, \(\Omega_k\), is computed which verifies the following constraints</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
   \partial \Omega_k = \Gamma_k \cup \Gamma_{fixed},
\end{equation*}\]
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\Omega_{k+1} = (\textrm{Id} + \theta_k)(\Omega_k).
\end{equation*}\]
</div>
</div>
<div class="sidebarblock prob">
<div class="content">
<div class="title">Expansion problem for the NSGF method</div>
<div class="paragraph">
<p>Using the NSGF method, we define the displacement field \(\theta_k\) over all \(\Omega_k\) such that</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{equation*}
\begin{cases}
-\Delta\theta_k = 0 &amp;\qquad \text{in } \Omega_k \\
\theta_k = 0 &amp;\qquad \text{on } \Gamma_{fixed} \\
\frac{\partial \theta_k}{\partial n} = -\alpha_C \xi_C(\Omega_k) - \alpha_J \xi_J(\Omega_k) &amp;\qquad \text{on } \Gamma_k.
 \end{cases}
\end{equation*}\]
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references_on_geometric_shape_optimisation"><a class="anchor" href="#_references_on_geometric_shape_optimisation"></a>References on geometric shape optimisation</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="internship_Palazzolo"></a>[internship_Palazzolo] Lucas Palazzolo. <em>Shape optimization for rigid objects in Stokes flow</em>. Stage de M2, Univerité de Strasbourg/Inria Sophia-Antipolis, 2023. <a href="https://github.com/feelpp/stage.lucas">repo</a></p>
</li>
<li>
<p><a id="allaire_conception_2006"></a>[allaire_conception_2006]  Grégoire Allaire. <em>Conception optimale de structures</em>. volume 58 of Mathématiques &amp; applications. Springer Berlin Heidelberg, 2006</p>
</li>
<li>
<p><a id="cea_conception_1986"></a>[cea_conception_1986] Jean Céa. <em>Conception optimale ou identification de formes, calcul rapide de la dérivée directionnelle de la fonction coût.</em> M2AN - Modélisation mathématique et analyse numérique, 20(3):371-402, 1986</p>
</li>
<li>
<p><a id="moreau_shapes_2022"></a>[moreau_shapes_2022] Clément Moreau, Kenta Ishimoto and Yannick Privat. <em>Shapes optimising grand resistance tensor entries for a rigid body in a Stokes flow</em>. July 2022</p>
</li>
<li>
<p><a id="feppon_shape_2019"></a>[feppon_shape_2019] Florian Feppon. <em>Shape and topology optimization of multiphysics systems</em>. These de doctorat, Université Paris-Saclay (ComUE), Dec. 2019</p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.cemosis.fr" class="icon">
            <img src="../_/img/logoCemosisTransparent.png" alt="Cemosis">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.cemosis.fr" target="_blank" rel="noopener">Projects Documentation</a></li>
          <li><a href="https://join.slack.com/t/feelpp/shared_invite/zt-2qe0q9hw-4pVbhohCXUE6Po9Ma8dbiQ" target="_blank" rel="noopener">Forums(Slack)</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.cemosis.fr" target="_blank" rel="noopener">Cemosis</a></li>
          <li><a href="https://www.cemosis.fr/news" target="_blank" rel="noopener">News</a></li>
          <li><a href="https://www.cemosis.fr/projects" target="_blank" rel="noopener">Projects</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.feelpp.org" target="_blank" rel="noopener">Feel++ Documentation</a></li>
          <li><a href="http://docs.feelpp.org/user/">Get Started</a></li>
          <li><a href="http://docs.feelpp.org/user//install/distributions/">Downloads</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/cemosis.fr" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/cemosis" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/cemosis" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Cemosis, Université de Strasbourg</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.cemosis.fr/terms-of-use">Terms of Use</a>
        <a href="https://www.cemosis.fr/privacy-policy">Privacy Policy</a>
        <a href="https://www.cemosis.fr/cookie-policy">Cookie Policy</a>
        <a href="https://www.cemosis.fr/support-policy">Support Policy</a>
      </div>
    </div>
  </div>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>


<script async src="../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../_/js/vendor/fontawesome.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>


<script type="text/javascript">
function toggleFullScreen() {
   var doc = window.document;
   var docEl = doc.documentElement;

   var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
   var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

   if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
       requestFullScreen.call(docEl);
   }
   else {
       cancelFullScreen.call(doc);
   }
}
</script>
  </body>
</html>
